# MiniDiary 设计规范

## 1. 设计哲学

**黑白灰极简主义**

- **极简至上**：去除一切不必要的视觉元素
- **留白艺术**：大量负空间，让内容呼吸
- **无色干扰**：纯黑白灰系统，除用户图片外零彩色
- **微妙层次**：通过灰度、透明度构建视觉层级
- **克制动效**：动画存在但不喧宾夺主

---

## 2. 色彩系统

### 亮色模式
| Token | 色值 | 用途 |
|-------|------|------|
| Primary | `#000000` | 主要文字、强调元素 |
| Secondary | `#111827` | 次要文字 |
| Tertiary | `#6B7280` | 辅助文字、占位符 |
| Background | `#FFFFFF` | 主背景 |
| Surface | `#FFFFFF` | 卡片背景 |
| Border | `#E5E7EB` | 分割线、边框 |

### 暗色模式
| Token | 色值 | 用途 |
|-------|------|------|
| Primary | `#F4F4F5` | 主要文字 |
| Secondary | `#A1A1AA` | 次要文字 |
| Tertiary | `#52525B` | 辅助文字、占位符 |
| Background | `#09090B` | 主背景 |
| Surface | `#18181B` | 卡片背景 |
| Border | `#27272A` | 分割线、边框 |
| Button Primary | `#27272A` | 按钮背景（FAB、主要按钮） |

### 交互状态
| 状态 | 样式 |
|------|------|
| Hover | `opacity: 0.8` |
| Active | `opacity: 0.6` |
| Focus | 2px 黑色/白色边框 |
| Disabled | `opacity: 0.4` |

---

## 3. 排版

### 字体栈
```css
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue",
  "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
```

### 字号规范
| 级别 | 移动端 | 桌面端 | 用途 |
|------|--------|--------|------|
| xs | 12px | 12px | 辅助信息 |
| sm | 14px | 14px | 正文（移动端） |
| base | 14px | 16px | 正文（桌面端） |
| lg | 16px | 18px | 小标题 |
| xl | 20px | 24px | 标题 |

### 字重
| 权重 | 值 | 用途 |
|------|-----|------|
| Regular | 400 | 正文 |
| Medium | 500 | 强调 |
| Bold | 700 | 标题 |

### 行高
- 正文：1.6 - 1.8
- 标题：1.2 - 1.4

### 字间距 (Letter-spacing)
| 类型 | 值 | 用途 |
|------|-----|------|
| tight | -0.02em | 标题 |
| normal | 0 | 正文 |
| relaxed | 0.01em | 辅助文字 |

---

## 4. 间距系统

基于 8px 基准：

| Token | 值 | 用途 |
|-------|-----|------|
| xs | 4px | 紧凑间距 |
| sm | 8px | 元素内间距 |
| md | 16px | 组件间距 |
| lg | 24px | 区块间距 |
| xl | 32px | 大区块间距 |
| 2xl | 48px | 页面级间距 |

### 组件间距模块
| 组件 | 属性 | 值 |
|------|------|-----|
| 按钮 | 水平内边距 | 12px |
| 按钮 | 垂直内边距 | 8px |
| 卡片 | 内边距 | 16px (移动) / 20px (桌面) |
| 卡片 | 元素间距 | 12px |
| 列表 | 项目间距 | 8px |

---

## 5. 圆角

几何极简主义，保持克制：

| Token | 值 | 用途 |
|-------|-----|------|
| none | 0px | 分割线 |
| sm | 2px | 按钮、输入框 |
| md | 4px | 卡片 |
| lg | 8px | Modal、Dialog |

**原则**：避免过大圆角，保持硬朗几何感。

---

## 6. 阴影

极度克制，优先使用边框/透明度建立层次：

### 亮色模式
| 级别 | 值 |
|------|-----|
| xs | `0 1px 2px rgba(0, 0, 0, 0.04)` |
| sm | `0 1px 3px rgba(0, 0, 0, 0.08)` |
| md | `0 2px 8px rgba(0, 0, 0, 0.12)` |
| lg | `0 4px 16px rgba(0, 0, 0, 0.16)` |

### 暗色模式
暗色模式使用更深的黑色阴影（而非白色），产生自然的"浮起"效果：

| 级别 | 值 |
|------|-----|
| xs | `0 1px 2px rgba(0, 0, 0, 0.20)` |
| sm | `0 1px 3px rgba(0, 0, 0, 0.30)` |
| md | `0 2px 8px rgba(0, 0, 0, 0.40)` |
| lg | `0 4px 16px rgba(0, 0, 0, 0.50)` |

---

## 7. 组件样式

### 顶部导航栏 (TopBar)
- 背景：Background
- 底部边框：1px Border
- 图标：24×24px，Primary
- 日期文字：Primary，字重 500
- 按钮：无背景，hover 时 Surface 背景

### FAB 按钮
- 尺寸：56×56px
- 背景：Primary（亮色模式：黑色，暗色模式：深灰色 `#27272A`）
- 图标：背景反色（亮色模式：白色，暗色模式：白色）
- 阴影：md
- Hover：scale(1.05) + 阴影增强

### 日记卡片
- 背景：Surface
- 边框：1px Border（可选）
- 内边距：16px（移动）/ 20px（桌面）
- 时间文字：Tertiary，小字号
- 正文：Primary，标准字号
- 图片：圆角 sm

### 语言切换按钮组
- 位置：设置侧边栏，主题切换下方
- 样式：与主题切换保持一致的按钮组
- 两个选项：简体中文 / English
- 选中状态：`border-foreground bg-surface`
- 未选中状态：`border-border hover:bg-surface`

### 输入框
- 背景：Surface
- 边框：1px Border
- Focus：2px Primary 边框
- Placeholder：Tertiary

### Modal/Dialog
- 背景遮罩：黑色 50% 透明度
- 内容背景：Background
- 圆角：lg
- 主按钮：Primary 实心
- 次按钮：透明 + 边框

### Toast
- 背景：Surface
- 边框：1px Border
- 阴影：sm
- 文字：Primary

---

## 8. 动画规范

使用 Motion (motion.dev) 实现。

### SSR 兼容性
由于使用 TanStack Start（SSR 框架），动画组件需注意：
- 使用 `'use client'` 指令确保客户端渲染
- 初始状态使用 CSS 而非 JS 避免闪烁
- 复杂动画组件延迟加载（lazy loading）

### 设计原则
- 微妙精致，不喧宾夺主
- 仅用 `transform` / `opacity`（GPU 加速）
- 遵循 `prefers-reduced-motion`
- 统一缓动和时长

### 时长规范
| 类型 | 时长 | 用途 |
|------|------|------|
| fast | 150ms | 按钮反馈 |
| normal | 250ms | 页面过渡 |
| slow | 350ms | 复杂动画 |

### 缓动函数
```typescript
const easing = {
  smooth: [0.4, 0, 0.2, 1],       // 默认，平滑过渡
  snappy: [0.34, 1.56, 0.64, 1],  // 弹性，有轻微回弹
  exit: [0.4, 0, 1, 1],           // 退出，加速离开
  bounce: [0.68, -0.55, 0.265, 1.55], // 反弹效果（慎用）
};
```

### 关键动画

**页面进入**
```typescript
initial={{ opacity: 0, y: 8 }}
animate={{ opacity: 1, y: 0 }}
transition={{ duration: 0.25, ease: easing.smooth }}
```

**页面退出**
```typescript
exit={{ opacity: 0, y: -8 }}
transition={{ duration: 0.2, ease: easing.exit }}
```

**FAB 按钮**
```typescript
whileHover={{ scale: 1.05 }}
whileTap={{ scale: 0.95 }}
```

**日记卡片列表**
```typescript
// 父容器
variants={{
  show: { transition: { staggerChildren: 0.03 } } // 0.03s 更流畅
}}

// 子项
variants={{
  hidden: { opacity: 0, y: 20 },
  show: { opacity: 1, y: 0 }
}}
```

**时间线入场动画策略**（实现见 `useTimelineAnimationPolicy`）  
- **有动画**：首次进入首页、切换日期（页面与卡片均播放入场动画）  
- **无动画**：从编辑/新建返回同一天、同一天内新增条目（避免重复动效）

**侧边栏**
```typescript
initial={{ x: -300, opacity: 0 }}
animate={{ x: 0, opacity: 1 }}
exit={{ x: -300, opacity: 0 }}
transition={{ duration: 0.3, ease: easing.smooth }}
```

**Toast**
```typescript
initial={{ y: -100, opacity: 0 }}
animate={{ y: 0, opacity: 1 }}
exit={{ y: -100, opacity: 0 }}
```

---

## 9. 响应式设计

### 断点
| 名称 | 宽度 | 说明 |
|------|------|------|
| mobile | <640px | 默认设计 |
| tablet | 640-1024px | 可选优化 |
| desktop | >1024px | 最大宽度限制 |

### 布局原则
- **Mobile First**：优先设计移动端
- **最大宽度**：内容区 max-w-[600px] 居中
- **触摸友好**：最小点击区域 48×48px

### 具体响应式规则
| 断点 | 内容最大宽度 | 页面内边距 | 卡片内边距 |
|------|-------------|-----------|-----------|
| mobile (<640px) | 100% | 20px | 16px |
| tablet (640-1024px) | 600px | 24px | 20px |
| desktop (>1024px) | 600px | 32px | 20px |

---

## 10. 无障碍 (A11y)

遵循 WCAG 2.2 AA 级：

| 要求 | 实现 |
|------|------|
| 颜色对比度 | 最小 4.5:1 |
| 键盘导航 | `←` `→` 切换日期，Tab 焦点 |
| ARIA 标签 | 所有交互元素 |
| 触摸目标 | 最小 48×48px |
| 焦点指示器 | 2px 高对比度边框 + 外环光晕 |
| 语义化 HTML | `<article>`, `role="navigation"` |

---

## 11. 页面状态设计

每个页面需考虑以下 5 种状态：

| 状态 | 说明 |
|------|------|
| **空白状态 (Empty)** | 完全无数据 |
| **加载状态 (Loading)** | 数据获取中 |
| **错误状态 (Error)** | 操作失败或异常 |
| **未完成状态 (Incomplete)** | 介于空白和理想之间的过渡状态 |
| **理想状态 (Ideal)** | 数据充实、视觉饱满 |

**未完成状态**包含多种情形：
- 操作进行中（图片上传、数据导入）
- 表单不完整（必填项空白、内容超限）
- 内容稀疏（只有 1-2 条记录，页面显得空荡）
- 草稿状态（有未保存的修改）
- 部分加载（文字已显示，图片还在加载）

---

### 11.1 首页/时间线

| 状态 | 场景 | 视觉设计 |
|------|------|----------|
| **空白** | 当日无日记 | 居中插画 + "今天还是一片空白" + "点击 + 开始记录" |
| **加载** | 首次加载/切换日期 | 3 个骨架屏卡片，pulse 动画 |
| **错误** | IndexedDB 读取失败 | 警告图标 + "数据加载失败" + 重试按钮 |
| **未完成 - 稀疏** | 只有 1-2 条日记 | 显示日记卡片 + 底部轻提示 "继续记录今天的点滴" |
| **未完成 - 图片加载中** | 文字已显示，图片加载中 | 图片区域灰色占位 + 小 spinner |
| **理想** | 3+ 条日记 | 日记卡片列表，视觉饱满，stagger 动画 |

**稀疏状态设计思路**：
- 不使用空状态插画（因为有内容）
- 在列表底部添加轻量引导，而非强提示
- 引导文案使用 Tertiary 色，不抢视觉焦点

---

### 11.2 编辑页

| 状态 | 场景 | 视觉设计 |
|------|------|----------|
| **空白** | 新建日记，未输入内容 | Placeholder "写点什么..."，保存按钮 Disabled |
| **加载** | 编辑模式加载已有日记 | 文本区骨架屏（通常 <500ms，可省略） |
| **错误** | 保存失败 | Toast "保存失败，请重试"，按钮恢复可点击 |
| **未完成 - 图片上传中** | 图片压缩/上传中 | 图片位显示进度环 + 百分比，可继续编辑文字 |
| **未完成 - 草稿** | 有未保存修改 | 标题栏显示小圆点（8px），退出时二次确认 |
| **未完成 - 内容过短** | 只输入几个字 | 正常显示，无特殊提示（不强制用户多写） |
| **未完成 - 内容超限** | >10,000 字符 | 字数统计变红，允许保存但显示警告 |
| **理想** | 内容充实，图片已上传 | 保存按钮可点击，字数统计正常 |

---

### 11.3 搜索页

| 状态 | 场景 | 视觉设计 |
|------|------|----------|
| **空白 - 初始** | 刚进入，未输入 | 显示最近搜索历史（最多 5 条） |
| **空白 - 无历史** | 无搜索历史 | 提示 "输入关键词搜索日记" |
| **空白 - 无结果** | 搜索完成但无匹配 | "未找到 '{keyword}' 相关记录" |
| **加载** | 搜索中 | 输入框右侧小 spinner |
| **错误** | 搜索出错 | Toast "搜索失败" |
| **未完成 - 输入中** | 正在输入，等待防抖 | 实时显示输入，300ms 后触发搜索 |
| **未完成 - 少量结果** | 只有 1-2 条结果 | 正常显示结果，不额外提示 |
| **理想** | 多条匹配结果 | 结果列表，关键词加粗高亮 |

---

### 11.4 侧边栏/设置

| 状态 | 场景 | 视觉设计 |
|------|------|----------|
| **加载** | 获取存储空间信息 | 存储监控区域骨架屏 |
| **错误** | 导出/导入失败 | Toast 显示错误原因 |
| **未完成 - 导出中** | 导出数据生成中 | 按钮 "导出中..." + spinner |
| **未完成 - 导入中** | 导入数据处理中 | 进度条 + 百分比 |
| **未完成 - 清空确认流程** | 多步确认中 | Modal 逐步引导（见下） |
| **理想** | 正常显示 | 菜单列表 + 存储监控 |

**清空数据确认流程（3 步）**：
1. Modal："此操作将永久删除所有日记，且无法恢复"
2. 输入框：要求输入 "确认删除"，正确前按钮 Disabled
3. 最终确认："确定删除？"
4. 完成后 Toast："已清空所有数据"

---

### 11.5 状态设计通用规范

#### 视觉元素

| 元素 | 规格 |
|------|------|
| 骨架屏 | Surface 背景，pulse 动画 1s（最小显示 300ms） |
| Spinner | Primary 色，24px，1s 循环 |
| 进度环 | Primary 色，stroke 2px |
| 空状态插画 | 黑白线条，简洁几何形状 |
| 草稿指示器 | 8px 圆点，Primary 色 |
| 错误图标 | ExclamationTriangle (Heroicons) |

#### 文案原则

- 简短直接，不超过 15 字
- 告知状态 + 下一步操作
- 稀疏状态使用轻量引导，不施压
- 错误说明原因，不只说"出错了"

#### 状态切换动画

| 切换类型 | 动画 |
|----------|------|
| 加载 → 内容 | crossfade 250ms |
| 任意 → 错误 | fade in 150ms |
| 空白 → 有数据 | fade + slide up 250ms |

#### 稀疏状态处理原则

- 有数据就不用空状态插画
- 引导放在内容之后（底部），不喧宾夺主
- 使用 Tertiary 色，降低视觉权重
- 不强制用户多写/多记，仅轻提示

---

## 12. 图标规范

使用 Heroicons 图标库（outline 风格为主）：

| 图标 | 用途 | 尺寸 |
|------|------|------|
| Bars3 | 汉堡菜单 | 24px |
| MagnifyingGlass | 搜索入口 | 24px |
| Plus | FAB 新建 | 24px |
| ChevronLeft/Right | 日期导航 | 20px |
| XMark | 关闭/删除 | 20px |
| Check | 确认 | 20px |
| Trash | 删除 | 20px |

颜色：继承当前文字颜色（Primary）
