# MiniDiary 产品需求文档 (PRD)

## 1. 产品概述

**MiniDiary** 是一个基于 PWA 技术的极简日记应用，灵感来自社交媒体时间线。用户可以快速记录想法、琐事或工作日志，内容按天汇聚展示。所有数据存储在本地浏览器中，确保完全隐私和离线可用。

### 1.1 产品愿景

为用户提供一个"打开即写、写完即走"的轻量级记录工具，像发推文一样简单，但数据完全属于自己。

### 1.2 目标用户

- 希望快速记录日常的个人用户
- 注重隐私、不想数据上云的用户
- 需要离线使用的用户

### 1.3 核心价值

| 价值点 | 说明 |
|--------|------|
| 极简 | 无需注册、无需配置，打开即用 |
| 隐私 | 数据本地存储，零服务器通信 |
| 离线 | PWA 技术，断网也能完整使用 |
| 快速 | 类似发微博的体验，降低记录门槛 |

---

## 2. 信息架构

```
MiniDiary
├── 首页 (时间线)
│   ├── 顶部导航栏
│   │   ├── 汉堡菜单 → 侧边栏
│   │   ├── 日期选择器
│   │   └── 搜索入口
│   ├── 日记时间流
│   └── 新建按钮 (FAB)
├── 编辑页 (新建/编辑)
├── 搜索页
└── 侧边栏 (设置)
    ├── 数据导出
    ├── 数据导入
    ├── 主题切换
    └── 清空数据
```

---

## 3. 功能需求

### 3.1 首页与时间线 [P0]

**概述**：以时间线形式展示当日的所有日记条目。

**用户故事**：
- 作为用户，我希望打开应用后看到今天的日记，方便我回顾和补充
- 作为用户，我希望能切换到任意历史日期，查看和补录过去的记录

**功能点**：

| 功能 | 描述 | 验收标准 |
|------|------|----------|
| 默认定位今天 | 启动时自动定位到当天 | 首次打开显示今日日期 |
| 日期导航 | 支持前后切换和日期选择 | `<` `>` 按钮可用，点击日期弹出选择器 |
| 时间流展示 | 按创建时间倒序展示日记卡片 | 最新的在最上面 |
| 日记卡片 | 显示时间、文本（Markdown 渲染）、图片缩略图 | 1 张大图，2-3 张拼图布局 |
| 空状态 | 当日无记录时显示提示 | 显示引导文案和插画 |
| 新建入口 | 底部悬浮按钮 (FAB) | 点击跳转编辑页 |

**边界情况**：
- 未来日期：`>` 按钮置灰不可点击
- 历史极限：支持查看到 1970-01-01
- 大数据量：超过 100 条启用虚拟滚动

---

### 3.2 新建与编辑 [P0]

**概述**：全屏编辑器，支持文本输入和图片上传。

**用户故事**：
- 作为用户，我希望快速记录一段文字，不需要设置标题或分类
- 作为用户，我希望能为日记添加照片，记录生活瞬间
- 作为用户，我希望能编辑已有的日记内容

**功能点**：

| 功能 | 描述 | 验收标准 |
|------|------|----------|
| 日期继承 | 新建时继承当前浏览日期 | 在 2024-01-01 页面点新建，日记日期为 2024-01-01 |
| 文本输入 | 支持多行文本，受限 Markdown | 支持加粗、斜体、有序/无序列表 |
| 图片上传 | 最多 3 张，自动压缩 | 支持相册选择，显示预览缩略图 |
| 保存 | 右上角保存按钮 | 保存后返回时间线 |
| 取消 | 左上角取消按钮 | 有修改时二次确认 |
| 删除 | 编辑模式底部删除按钮 | 二次确认后删除 |

**数据验证**：
- 内容：1-10,000 字符，不允许纯空白
- 图片：JPG/PNG/WebP，单张 <10MB，压缩后 <1MB
- 日期：不能晚于今天

**Markdown 支持范围**：
- 加粗：`**text**`
- 斜体：`*text*`
- 无序列表：`- item`
- 有序列表：`1. item`
- **不支持**：代码块、引用块、表格、链接

---

### 3.3 搜索 [P1]

**概述**：全文搜索所有日记内容。

**用户故事**：
- 作为用户，我希望通过关键词找到过去的某条记录

**功能点**：

| 功能 | 描述 | 验收标准 |
|------|------|----------|
| 实时搜索 | 输入即搜索，防抖 300ms | 输入后实时显示结果 |
| 结果展示 | 日期 + 摘要，关键词高亮 | 匹配词黄色高亮 |
| 跳转编辑 | 点击结果进入编辑页 | 可直接编辑该日记 |
| 空结果 | 无匹配时显示提示 | "未找到相关记录" |

---

### 3.4 侧边栏与设置 [P1]

**概述**：从左侧滑出的设置面板。

**功能点**：

| 功能 | 描述 | 验收标准 |
|------|------|----------|
| 数据导出 | 导出为 JSON 文件 | 包含所有日记和图片（Base64） |
| 数据导入 | 导入 JSON 备份 | 处理 ID 冲突，保留最新版本 |
| 主题切换 | 浅色/深色/跟随系统 | 实时切换，无需刷新 |
| 清空数据 | 删除所有日记 | 需输入确认文字 + 二次确认 |
| 存储监控 | 显示已用空间 | 使用 `navigator.storage.estimate()` |

---

## 4. 功能优先级

| 优先级 | 功能 | 说明 |
|--------|------|------|
| **P0** | 时间线视图 | MVP 核心 |
| **P0** | 日期导航 | MVP 核心 |
| **P0** | 创建/编辑/删除日记 | MVP 核心 |
| **P0** | 图片上传与压缩 | MVP 核心 |
| **P0** | 本地数据存储 | MVP 核心 |
| **P1** | 全文搜索 | 必要功能 |
| **P1** | 数据导入/导出 | 必要功能 |
| **P1** | 主题切换 | 必要功能 |
| **P1** | PWA 安装 | 必要功能 |
| **P2** | Web Worker 搜索 | 大数据量优化 |
| **P2** | HEIC 格式支持 | iOS 兼容 |
| **P2** | 图片 Lightbox | 体验增强 |

---

## 5. 错误处理

| 场景 | 用户提示 |
|------|----------|
| 内容为空 | "请输入日记内容" |
| 内容超长 | "内容已超过 10,000 字符限制" |
| 图片格式不支持 | "仅支持 JPG/PNG/WebP 格式" |
| 图片压缩失败 | "图片处理失败，请重试" |
| 存储空间不足 | "存储空间不足，请清理数据" |
| 保存失败 | "保存失败，请重试" |
| 未保存退出 | "有未保存的修改，确定离开吗？" |

---

## 6. 非功能性需求

| 维度 | 要求 |
|------|------|
| 性能 | 首屏加载 (FCP) < 1.5s，滚动保持 60fps |
| 离线 | 所有功能断网可用 |
| 隐私 | 零网络请求，无分析追踪 |
| 无障碍 | WCAG 2.2 AA 级，支持键盘导航 |
| 兼容性 | Chrome、Safari、Firefox 最新两个版本 |
